<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.34.0/smoothie.min.js"></script>
</head>
<body>

<canvas id="chart2" width="600" height="400"></canvas>

<script>
    // Pages to track
    var pages = ["P1", "P2"];

    // Colors for each line
    var colors = [
        { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)' },
        { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)' }
    ];

    // TimeSeries storage (use object, not array)
    var courbe = {};

    // Create SmoothieChart
    var smoothieChart = new SmoothieChart({ tooltip: true });
    smoothieChart.streamTo(document.getElementById("chart2"), 500);

    // Initialize TimeSeries for each page
    pages.forEach(function(v, i) {
        courbe[v] = new TimeSeries();
        smoothieChart.addTimeSeries(courbe[v], {
            strokeStyle: colors[i].strokeStyle,
            fillStyle: colors[i].fillStyle,
            lineWidth: 2
        });
    });

    // Connect to backend via SSE
    var stockEventSource = new EventSource("/analytics");

    stockEventSource.addEventListener("message", function(event) {
        var data = JSON.parse(event.data);
        pages.forEach(function(v) {
            // Default to 0 if key is missing
            var val = data[v] || 0;
            courbe[v].append(new Date().getTime(), val);
        });
    });

    stockEventSource.onerror = function(err) {
        console.error("EventSource failed:", err);
    };
</script>

</body>
</html>
